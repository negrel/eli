#!/usr/bin/env bash

source /eli/lib/log.sh

set -euo pipefail
shopt -s inherit_errexit

: ${ELI_BOOTLOADER_CFG_DST:="/boot/grub/grub.cfg"}

log_info "generating grub config..."

mkdir -p $(dirname $ELI_BOOTLOADER_CFG_DST)

GRUB_DEVICE=${ELI_ROOTFS_DST:-/} \
GRUB_DEVICE_BOOT=${ELI_BOOTLOADER_DEVICE:-/boot} \
  grub-mkconfig -o $ELI_BOOTLOADER_CFG_DST >&2

log_info "grub config generated."
